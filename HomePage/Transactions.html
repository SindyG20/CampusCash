<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Cash Bank - Transactions</title>
    <link rel="stylesheet" href="Transactions.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="logo">Campus Cash Bank</div>
        <nav class="top-nav">
            <ul>
                <li><a href="home.html">Home</a></li>
                <li><a href="appointments.html">Appointments</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="reports.html">Reports</a></li> 
                <li><a href="report-lost.html">Report Lost/Stolen</a></li> 
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="content">
        <section class="account-overview">
            <div class="account-card">
                <h3>Main Account</h3>
                <p class="account-number" id="main-account-number">CCB-XXXX-XXXX</p>
                <p class="account-balance" id="main-balance">R0.00</p>
            </div>
            
            <div class="account-card secondary">
                <h3>Savings Account</h3>
                <p class="account-number" id="savings-account-number">CCB-XXXX-XXXX</p>
                <p class="account-balance" id="savings-balance">R0.00</p>
            </div>
        </section>

        <section class="transaction-interface">
            <div class="transaction-tabs">
                <button class="tab-btn active" data-transaction="deposit">Deposit</button>
                <button class="tab-btn" data-transaction="withdraw">Withdraw</button>
                <button class="tab-btn" data-transaction="transfer">Transfer</button>
            </div>

            <div class="transaction-forms">
                <!-- Deposit Form -->
                <form id="deposit-form" class="transaction-form active">
                    <div class="form-group">
                        <label for="deposit-account">To Account</label>
                        <select id="deposit-account" required>
                            <option value="main">Main Account</option>
                            <option value="savings">Savings Account</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="deposit-amount">Amount</label>
                        <input type="number" id="deposit-amount" min="0.01" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="deposit-method">Method</label>
                        <select id="deposit-method" required>
                            <option value="cash">Cash</option>
                            <option value="card">Debit/Credit Card</option>
                            <option value="mobile">Mobile Payment</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="submit-btn">Complete Deposit</button>
                </form>

                <!-- Withdrawal Form -->
                <form id="withdraw-form" class="transaction-form">
                    <div class="form-group">
                        <label for="withdraw-account">From Account</label>
                        <select id="withdraw-account" required>
                            <option value="main">Main Account</option>
                            <option value="savings">Savings Account</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="withdraw-amount">Amount</label>
                        <input type="number" id="withdraw-amount" min="0.01" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="withdraw-method">Method</label>
                        <select id="withdraw-method" required>
                            <option value="cash">Cash</option>
                            <option value="check">Check</option>
                            <option value="atm">ATM Card</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="submit-btn">Process Withdrawal</button>
                </form>

                <!-- Transfer Form -->
                <form id="transfer-form" class="transaction-form">
                    <div class="form-group">
                        <label for="transfer-from">From Account</label>
                        <select id="transfer-from" required>
                            <option value="main">Main Account</option>
                            <option value="savings">Savings Account</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="transfer-to">To Account</label>
                        <select id="transfer-to" required>
                            <option value="savings">Savings Account</option>
                            <option value="main">Main Account</option>
                            <option value="external">External Account</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="external-account-group" style="display:none;">
                        <label for="external-account">Account Number</label>
                        <input type="text" id="external-account" placeholder="Enter account number">
                    </div>
                    
                    <div class="form-group">
                        <label for="transfer-amount">Amount</label>
                        <input type="number" id="transfer-amount" min="0.01" step="0.01" required>
                    </div>
                    
                    <button type="submit" class="submit-btn">Transfer Funds</button>
                </form>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Quick Links</h4>
                <a href="../HomePage/home.html">Home</a>
                <a href="#">Account</a>
                <a href="transactions.html">Transactions</a>
                <a href="reports.html">Reports</a> 
                <a href="report-lost.html">Report Lost/Stolen</a> 
            </div>
            <div class="footer-section">
                <h4>Contact Us</h4>
                <p>Email: support@campuscashbank.co.za</p>
                <p>Phone: +27 12 413 7159</p>
                <p>Location: NWU Vanderbijlpark, SA</p>
            </div>
        </div>
        <div style="text-align:center; margin-top: 20px;">
            &copy; 2025 Campus Cash Bank. All Rights Reserved.
        </div>
    </footer>

    <script>
        // ------------------------------
        // Load user data from localStorage
        // ------------------------------
        let user = JSON.parse(localStorage.getItem("campusCashUser"));
        if (!user) {
            alert("⚠️ Please log in first.");
            window.location.href = "login.html";
        }

        // Initialize accounts (main balance comes from user)
        let accounts = JSON.parse(localStorage.getItem("accounts")) || {
            main: user.balance || 0,
            savings: 0
        };

        function saveAccounts() {
            localStorage.setItem("accounts", JSON.stringify(accounts));
            // keep user.balance in sync with main account
            user.balance = accounts.main;
            localStorage.setItem("campusCashUser", JSON.stringify(user));
        }

        function renderBalances() {
            document.getElementById("main-account-number").textContent = user.accountNumber || "N/A";
            document.getElementById("main-balance").textContent = `R${accounts.main.toFixed(2)}`;
            document.getElementById("savings-balance").textContent = `R${accounts.savings.toFixed(2)}`;
        }

        // ------------------------------
        // Transaction functions
        // ------------------------------
        function deposit(toAcc, amount) {
            accounts[toAcc] += amount;
            saveAccounts();
            renderBalances();
            alert(`✅ Deposit of R${amount.toFixed(2)} to ${toAcc} successful!`);
        }

        function withdraw(fromAcc, amount) {
            if (amount > accounts[fromAcc]) {
                alert("❌ Insufficient funds!");
                return false;
            }
            accounts[fromAcc] -= amount;
            saveAccounts();
            renderBalances();
            alert(`✅ Withdrawal of R${amount.toFixed(2)} from ${fromAcc} successful!`);
            return true;
        }

        function transfer(fromAcc, toAcc, amount) {
            if (amount > accounts[fromAcc]) {
                alert("❌ Insufficient funds!");
                return false;
            }
            accounts[fromAcc] -= amount;
            if (toAcc !== "external") {
                accounts[toAcc] += amount;
            }
            saveAccounts();
            renderBalances();
            alert(`✅ Transfer of R${amount.toFixed(2)} from ${fromAcc} to ${toAcc} successful!`);
            return true;
        }

        // ------------------------------
        // Event Listeners
        // ------------------------------
        document.getElementById("deposit-form").addEventListener("submit", function(e) {
            e.preventDefault();
            const toAcc = document.getElementById("deposit-account").value;
            const amount = parseFloat(document.getElementById("deposit-amount").value);
            if (amount > 0) deposit(toAcc, amount);
            this.reset();
        });

        document.getElementById("withdraw-form").addEventListener("submit", function(e) {
            e.preventDefault();
            const fromAcc = document.getElementById("withdraw-account").value;
            const amount = parseFloat(document.getElementById("withdraw-amount").value);
            if (amount > 0) withdraw(fromAcc, amount);
            this.reset();
        });

        document.getElementById("transfer-form").addEventListener("submit", function(e) {
            e.preventDefault();
            const fromAcc = document.getElementById("transfer-from").value;
            const toAcc = document.getElementById("transfer-to").value;
            const amount = parseFloat(document.getElementById("transfer-amount").value);
            if (amount > 0) transfer(fromAcc, toAcc, amount);
            this.reset();
        });

        // External account field toggle
        document.getElementById("transfer-to").addEventListener("change", function() {
            document.getElementById("external-account-group").style.display =
                this.value === "external" ? "block" : "none";
        });

        // ------------------------------
        // Tab Switching
        // ------------------------------
        const tabButtons = document.querySelectorAll(".tab-btn");
        const forms = document.querySelectorAll(".transaction-form");
        tabButtons.forEach(btn => btn.addEventListener("click", () => {
            tabButtons.forEach(b => b.classList.remove("active"));
            forms.forEach(f => f.classList.remove("active"));
            btn.classList.add("active");
            document.getElementById(`${btn.dataset.transaction}-form`).classList.add("active");
        }));

        // Initialize page
        renderBalances();
    </script>
</body>
</html>
